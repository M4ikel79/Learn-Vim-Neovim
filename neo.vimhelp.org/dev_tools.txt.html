<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="color-scheme" content="light dark">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Neovim help pages, always up-to-date">
<title>Neovim: dev_tools.txt</title>
<link rel="shortcut icon" href="s/h3E0J2MHNKfIuCqP/favicon-neovim.ico">
<!-- favicon taken from https://neovim.io/favicon.ico, which is licensed under CC-BY-3.0: https://creativecommons.org/licenses/by/3.0/ -->

<link rel="stylesheet" href="s/MsMIu46igYudff1x/tom-select.min.css">
<script defer src="s/RLcAbtLBYX-q5me0/tom-select.base.min.js"></script>

<link rel="stylesheet" href="s/QRMkrs52-wJfIQ-w/vimhelp.css">
<noscript><link rel="stylesheet" href="s/eRFCn9A-K4lmzV_A/noscript.css"></noscript>
<script defer src="s/KpwrKyx19dtnhPoe/vimhelp.js"></script>
</head>
<body>




<div class="bar">
  <div class="ql">Quick links:
<a href="index.html">help overview</a> &middot;
<a href="quickref.txt.html">quick reference</a> &middot;
<a href="usr_toc.txt.html">user manual toc</a> &middot;
<a href="index.html#reference_toc">reference manual toc</a>
</div>
  <div class="tag srch need-js">
    <select id="vh-select-tag"></select>
    <div class="placeholder">Go to keyword<span class="not-mobile">&nbsp;(shortcut: <kbd>k</kbd>)</span></div>
  </div>
  <form class="site srch" action="https://duckduckgo.com" method="get" target="_blank" rel="noopener noreferrer">
    <input type="hidden" name="sites" value="neo.vimhelp.org">
    <input type="search" name="q" id="vh-srch-input" placeholder="Site search">
    <div class="placeholder need-js">Site search<span class="not-mobile">&nbsp;(shortcut: <kbd>s</kbd>)</span></div>
  </form>
  <div id="theme-switcher" class="need-js">
  <button id="theme-current" title="Switch theme">Theme</button>
  <div id="theme-dropdown"><ul>
    <li><button id="theme-native" title="Switch to native theme">Native</button></li>
    <li><button id="theme-light" title="Switch to light theme">Light</button></li>
    <li><button id="theme-dark" title="Switch to dark theme">Dark</button></li>
  </ul></div>
</div>

</div>

<main>
<div id="vh-sidebar">
<ul><li><a href="dev_tools.txt.html#">↑Top↑</a></li>
<li><a href="dev_tools.txt.html#dev-tools-backtrace">Backtraces</a></li>
<li><a href="dev_tools.txt.html#dev-tools-gdb">Gdb</a></li>
</ul>
</div>
<div id="vh-content">
<pre>
<span id="dev_tools.txt" class="t">dev_tools.txt</span>          Nvim


                            <span class="i">NVIM REFERENCE MANUAL</span>


Tools and techniques <a href="luaref.txt.html#for" class="d">for</a> developing Nvim                        <span id="dev-tools" class="t">dev-tools</span>

The following advice <a href="motion.txt.html#is" class="d">is</a> helpful when working on or debugging issues with Nvim
itself.

TODO: <a href="diff.txt.html#merge" class="d">merge</a> <a href="debug.txt.html#debug.txt" class="l">debug.txt</a> into here.

                                  Type <a href="various.txt.html#gO" class="l">gO</a> to see the table of contents.

<span class="h">==============================================================================</span>
Backtraces                                            <span id="dev-tools-backtrace" class="t">dev-tools-backtrace</span>

<span class="c">LINUX</span>

Core dumps are disabled by default on Ubuntu, CentOS and others.
To enable core dumps:
&gt;bash
    ulimit <a href="starting.txt.html#-c" class="d">-c</a> unlimited
<a href="change.txt.html#%3C" class="d">&lt;</a>
On systemd-based systems getting <a href="insert.txt.html#a" class="d">a</a> backtrace <a href="motion.txt.html#is" class="d">is</a> <a href="motion.txt.html#as" class="d">as</a> easy as:
&gt;bash
    coredumpctl -1 <a href="debug.txt.html#gdb" class="d">gdb</a>
<a href="change.txt.html#%3C" class="d">&lt;</a>
<span class="e">coredumpctl</span> <a href="motion.txt.html#is" class="d">is</a> an optional tool, so you may need to <a href="intro.txt.html#install" class="d">install</a> it:
&gt;bash
    sudo apt <a href="intro.txt.html#install" class="d">install</a> systemd-coredump
<a href="change.txt.html#%3C" class="d">&lt;</a>

The full backtrace <a href="motion.txt.html#is" class="d">is</a> most useful; please send us the <span class="e">backtrace.txt</span> file
when reporting <a href="insert.txt.html#a" class="d">a</a> bug related to <a href="insert.txt.html#a" class="d">a</a> crash:
&gt;bash
    2&gt;&amp;1 coredumpctl -1 <a href="debug.txt.html#gdb" class="d">gdb</a> | tee -a backtrace.txt
    (gdb) thread apply all bt full
<a href="change.txt.html#%3C" class="d">&lt;</a>

On systems without <span class="e">coredumpctl</span>, you may find <a href="insert.txt.html#a" class="d">a</a> <span class="e">core</span> dump file appearing
in the current directory or in other locations. On Linux systems where
<span class="e">apport</span> <a href="motion.txt.html#is" class="d">is</a> installed (such <a href="motion.txt.html#as" class="d">as</a> Ubuntu), the directory where core dump files
are saved can be <span class="e">/var/lib/apport/coredump</span> or elsewhere, depending on the
system configuration (see <span class="e">/proc/sys/kernel/core_pattern</span>). See also:
<a class="u" href="https://stackoverflow.com/a/18368068">https://stackoverflow.com/a/18368068</a>

To get <a href="insert.txt.html#a" class="d">a</a> backtrace from the <span class="e">./core</span> dump file:
&gt;bash
    <a href="debug.txt.html#gdb" class="d">gdb</a> build/bin/nvim ./core 2&gt;&amp;1 | tee backtrace.txt
    (gdb) thread apply all bt full
<a href="change.txt.html#%3C" class="d">&lt;</a>

<span class="c">MACOS</span>

If <span class="e">nvim</span> crashes, you can see the backtrace in <span class="e">Console.app</span> (under "Crash
Reports" or "<a href="autocmd.txt.html#User" class="d">User</a> Diagnostic Reports" <a href="luaref.txt.html#for" class="d">for</a> older macOS versions).
&gt;bash
    open -a Console
<a href="change.txt.html#%3C" class="d">&lt;</a>
You may also want to enable core dumps on macOS. To <a href="diff.txt.html#do" class="d">do</a> this, first make sure
the <span class="e">/cores/</span> directory exists and <a href="motion.txt.html#is" class="d">is</a> writable:
&gt;bash
    sudo mkdir /cores
    sudo chown root:admin /cores
    sudo <a href="vimfn.txt.html#chmod" class="d">chmod</a> 1775 /cores
<a href="change.txt.html#%3C" class="d">&lt;</a>
Then set the core size limit to <span class="e">unlimited</span>:
&gt;bash
    ulimit <a href="starting.txt.html#-c" class="d">-c</a> unlimited
<a href="change.txt.html#%3C" class="d">&lt;</a>
<span class="n">Note</span> that this <a href="motion.txt.html#is" class="d">is</a> done per shell process. If you want to make this the default
<a href="luaref.txt.html#for" class="d">for</a> all shells, add the above line to your shell's init file (e.g. <span class="e">~/.bashrc</span>
or similar).

You can then open the core file in <span class="e">lldb</span>:
&gt;bash
    lldb <a href="starting.txt.html#-c" class="d">-c</a> /cores/core.12345
<a href="change.txt.html#%3C" class="d">&lt;</a>
Apple's documentation archive has some other useful information
<a class="u" href="https://developer.apple.com/library/archive/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS">https://developer.apple.com/library/archive/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS</a>,
but <span class="n">note</span> that some of the things on this page are out of date (such <a href="motion.txt.html#as" class="d">as</a> enabling
core dumps with <span class="e">/etc/launchd.conf</span>).

<span class="h">==============================================================================</span>
Gdb                                                          <span id="dev-tools-gdb" class="t">dev-tools-gdb</span>

<span class="c">USING GDB TO STEP THROUGH FUNCTIONAL TESTS</span>

Use <span class="e">TEST_TAG</span> to run tests matching busted <a href="tagsrch.txt.html#tags" class="d">tags</a> (of the form <span class="e">#foo</span> e.g.
`it("test #foo <a href="userfunc.txt.html#..." class="d">...</a>"<a href="motion.txt.html#%2C" class="d">,</a> ...)`):
&gt;bash
    GDB=1 TEST_TAG=foo make functionaltest
<a href="change.txt.html#%3C" class="d">&lt;</a>
Then, in another terminal:
&gt;bash
    <a href="debug.txt.html#gdb" class="d">gdb</a> build/bin/nvim
    (gdb) target remote localhost:7777

<a href="starting.txt.html#--" class="d">--</a> See <span class="e">nvim_argv</span> in <a class="u" href="https://github.com/neovim/neovim/blob/master/test/functional/testnvim.lua">https://github.com/neovim/neovim/blob/master/test/functional/testnvim.lua</a>.

<span class="c">USING LLDB TO STEP THROUGH UNIT TESTS</span>


<span class="e">    lldb .deps/usr/bin/luajit -- .deps/usr/bin/busted --lpath="./build/?.lua" test/unit/</span>

<span class="c">USING GDB</span>

To attach to <a href="insert.txt.html#a" class="d">a</a> running <span class="e">nvim</span> process with <a href="insert.txt.html#a" class="d">a</a> pid of 1234 (Tip: the pid of <a href="insert.txt.html#a" class="d">a</a>
running Nvim instance can be obtained by calling <a href="vimfn.txt.html#getpid%28%29" class="l">getpid()</a>), <a href="luaref.txt.html#for" class="d">for</a> instance:
&gt;bash
    <a href="debug.txt.html#gdb" class="d">gdb</a> -tui <a href="starting.txt.html#-p" class="d">-p</a> 1234 build/bin/nvim
<a href="change.txt.html#%3C" class="d">&lt;</a>
The <span class="e">gdb</span> interactive prompt will appear. At any time you can:

<a href="motion.txt.html#-" class="d">-</a> `break foo` to set <a href="insert.txt.html#a" class="d">a</a> breakpoint on the <span class="e">foo()</span> function
<a href="motion.txt.html#-" class="d">-</a> <span class="e">n</span> to step over the next statement
    <a href="motion.txt.html#-" class="d">-</a> <span class="e">&lt;Enter&gt;</span> to repeat the last command
<a href="motion.txt.html#-" class="d">-</a> <span class="e">s</span> to step into the next statement
<a href="motion.txt.html#-" class="d">-</a> <span class="e">c</span> to continue
<a href="motion.txt.html#-" class="d">-</a> <span class="e">finish</span> to step out of the current function
<a href="motion.txt.html#-" class="d">-</a> `p zub` to print the value of <span class="e">zub</span>
<a href="motion.txt.html#-" class="d">-</a> <span class="e">bt</span> to see <a href="insert.txt.html#a" class="d">a</a> backtrace (callstack) from the current location
<a href="motion.txt.html#-" class="d">-</a> `CTRL-x <span class="k">CTRL-a</span>` or `tui enable` to show <a href="insert.txt.html#a" class="d">a</a> <a href="tui.txt.html#TUI" class="d">TUI</a> view of the source file in the
  current debugging context. This can be extremely useful <a href="motion.txt.html#as" class="d">as</a> <a href="motion.txt.html#it" class="d">it</a> avoids the
  need <a href="luaref.txt.html#for" class="d">for</a> <a href="insert.txt.html#a" class="d">a</a> <a href="debug.txt.html#gdb" class="d">gdb</a> "frontend"<a href="repeat.txt.html#." class="d">.</a>
<a href="motion.txt.html#-" class="d">-</a> <span class="e">&lt;up&gt;</span> and <span class="e">&lt;down&gt;</span> to scroll the source file view

<span class="c">GDB REVERSE DEBUGGING</span>

<a href="motion.txt.html#-" class="d">-</a> `set record full insn-number-max unlimited`
<a href="motion.txt.html#-" class="d">-</a> <span class="e">continue</span> <a href="luaref.txt.html#for" class="d">for</a> <a href="insert.txt.html#a" class="d">a</a> bit (at least until <span class="e">main()</span> <a href="motion.txt.html#is" class="d">is</a> executed
<a href="motion.txt.html#-" class="d">-</a> <span class="e">record</span>
<a href="motion.txt.html#-" class="d">-</a> provoke the bug, then use <span class="e">revert-next</span>, <span class="e">reverse-step</span>, etc. to rewind the
  debugger

<span class="c">USING GDBSERVER</span>

You may want to connect multiple <span class="e">gdb</span> clients to the same running <span class="e">nvim</span>
process, or you may want to connect to <a href="insert.txt.html#a" class="d">a</a> remote <span class="e">nvim</span> process with <a href="insert.txt.html#a" class="d">a</a> local
<span class="e">gdb</span>. Using <span class="e">gdbserver</span>, you can attach to <a href="insert.txt.html#a" class="d">a</a> single process and <a href="intro.txt.html#control" class="d">control</a> <a href="motion.txt.html#it" class="d">it</a>
from multiple <span class="e">gdb</span> clients.

Open <a href="insert.txt.html#a" class="d">a</a> <a href="terminal.txt.html#terminal" class="d">terminal</a> and start <span class="e">gdbserver</span> attached to <span class="e">nvim</span> like this:
&gt;bash
    gdbserver :6666 build/bin/nvim 2&gt; gdbserver.log
<a href="change.txt.html#%3C" class="d">&lt;</a>
<span class="e">gdbserver</span> <a href="motion.txt.html#is" class="d">is</a> now listening on port 6666. You then need to attach to this
debugging session in another terminal:
&gt;bash
    <a href="debug.txt.html#gdb" class="d">gdb</a> build/bin/nvim
<a href="change.txt.html#%3C" class="d">&lt;</a>
Once you've entered <span class="e">gdb</span>, you need to attach to the remote session:

<span class="e">    (gdb) target remote localhost:6666</span>

In <a href="change.txt.html#case" class="d">case</a> gdbserver puts the <a href="tui.txt.html#TUI" class="d">TUI</a> <a href="motion.txt.html#as" class="d">as</a> <a href="insert.txt.html#a" class="d">a</a> background process, the <a href="tui.txt.html#TUI" class="d">TUI</a> can become
unable to read input from pty (and receives SIGTTIN signal) and/or output data
(SIGTTOU signal). To force the <a href="tui.txt.html#TUI" class="d">TUI</a> <a href="motion.txt.html#as" class="d">as</a> the foreground process, you can add
&gt;c
    signal (SIGTTOU, SIG_IGN);
    if (!tcsetpgrp(data-&gt;input.in_fd, getpid())) <a href="motion.txt.html#%7B" class="d">{</a>
        perror("tcsetpgrp failed");
    <a href="motion.txt.html#%7D" class="d">}</a>
<a href="change.txt.html#%3C" class="d">&lt;</a>
to <span class="e">tui.c:terminfo_start</span>.

<span class="c">USING GDBSERVER IN TMUX</span>

Consider using <a href="insert.txt.html#a" class="d">a</a> custom makefile
<a class="u" href="https://github.com/neovim/neovim/blob/master/BUILD.md#custom-makefile">https://github.com/neovim/neovim/blob/master/BUILD.md#custom-makefile</a> to
quickly start debugging sessions using the <span class="e">gdbserver</span> <a href="vimeval.txt.html#method" class="d">method</a> mentioned above.
This example <span class="e">local.mk</span> will create the debugging session when you type `make
debug`.
&gt;make
    .PHONY: dbg-start dbg-attach debug build

    build:
        @$(MAKE) <a href="nvim.txt.html#nvim" class="d">nvim</a>

    dbg-start: build
        @tmux new-window <a href="starting.txt.html#-n" class="d">-n</a> 'dbg-neovim' 'gdbserver :6666 ./build/bin/nvim -D'

    dbg-attach:
        @tmux new-window <a href="starting.txt.html#-n" class="d">-n</a> 'dbg-cgdb' 'cgdb -x gdb_start.sh ./build/bin/nvim'

    debug: dbg-start dbg-attach
<a href="change.txt.html#%3C" class="d">&lt;</a>
Here <span class="e">gdb_start.sh</span> includes <span class="e">gdb</span> commands to be called when the debugger
starts. It needs to attach to the server started by the <span class="e">dbg-start</span> rule. For
example:

<span class="e">    (gdb) target remote localhost:6666</span>
<span class="e">    (gdb) br main</span>


vim:tw=78:ts=8:et:ft=help:norl:


</pre>
</div>
</main>
<p>Quick links:
<a href="index.html">help overview</a> &middot;
<a href="quickref.txt.html">quick reference</a> &middot;
<a href="usr_toc.txt.html">user manual toc</a> &middot;
<a href="index.html#reference_toc">reference manual toc</a>
</p>
<footer>This site is maintained by Carlo Teubner (<i>(my first name) at cteubner dot net</i>).</footer>
</body>
</html>